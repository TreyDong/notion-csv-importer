# CSVåˆ°Notionå¯¼å…¥å·¥å…· - Dockerç‰ˆæœ¬

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„Dockeråº”ç”¨ï¼Œæä¾›Webç•Œé¢æ¥ä¸Šä¼ CSVæ–‡ä»¶å¹¶å¯¼å…¥åˆ°Notionæ•°æ®åº“ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸŒ Webç•Œé¢ä¸Šä¼ CSVæ–‡ä»¶
- ğŸ”— è‡ªåŠ¨å…³è”è‚¡ç¥¨æŒä»“æ•°æ®åº“
- ğŸ“Š æ™ºèƒ½æ•°æ®æ¸…ç†å’Œæ ¼å¼è½¬æ¢
- âš™ï¸ å¯é…ç½®çš„å¯¼å…¥å‚æ•°
- ğŸ“ è‡ªåŠ¨æ·»åŠ "å¤–éƒ¨å¯¼å…¥"å¤‡æ³¨
- ğŸ“‹ æ”¯æŒExcelå…¬å¼æ ¼å¼æ¸…ç†

## å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œè®¾ç½®ä»¥ä¸‹å˜é‡ï¼š

```bash
# Notion APIé…ç½®
NOTION_TOKEN=your_notion_token_here
NOTION_DATABASE_ID=your_main_database_id_here
NOTION_HOLDINGS_DATABASE_ID=your_holdings_database_id_here

# CSVæ–‡ä»¶é…ç½®
CSV_FILE_PATH=Table_5478.csv
CSV_ENCODING=gbk
```

### 2. ä½¿ç”¨Docker Composeå¯åŠ¨

```bash
# æ„å»ºå¹¶å¯åŠ¨åº”ç”¨
docker-compose up --build

# åå°è¿è¡Œ
docker-compose up -d --build
```

### 3. è®¿é—®Webç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8000

## ä½¿ç”¨è¯´æ˜

### Webç•Œé¢æ“ä½œ

1. **ä¸Šä¼ CSVæ–‡ä»¶**: ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æŒ‰é’®ï¼Œé€‰æ‹©ä½ çš„CSVæ–‡ä»¶
2. **é…ç½®å¯¼å…¥å‚æ•°**:
   - å¯¼å…¥è¡Œæ•°é™åˆ¶: è®¾ç½®è¦å¯¼å…¥çš„è¡Œæ•°ï¼ˆ0è¡¨ç¤ºå…¨éƒ¨ï¼‰
   - æ‰¹é‡å¤„ç†å¤§å°: è®¾ç½®æ¯æ‰¹å¤„ç†çš„è¡Œæ•°
   - è¯·æ±‚é—´éš”: è®¾ç½®APIè¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰
3. **å¼€å§‹å¯¼å…¥**: ç‚¹å‡»"ä¸Šä¼ å¹¶å¯¼å…¥"æŒ‰é’®å¼€å§‹å¤„ç†

### æ•°æ®å¤„ç†æµç¨‹

1. **æ–‡ä»¶è§£æ**: è‡ªåŠ¨è§£æCSVæ–‡ä»¶å¹¶æ¸…ç†æ•°æ®
2. **Excelå…¬å¼æ¸…ç†**: è‡ªåŠ¨å¤„ç†å¦‚`= "588200      "`æ ¼å¼çš„æ•°æ®
3. **å­—æ®µæ˜ å°„**: ä½¿ç”¨é¢„å®šä¹‰çš„æ˜ å°„å…³ç³»
4. **æŒä»“å…³è”**: 
   - æ£€æŸ¥æŒä»“æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨è¯¥è‚¡ç¥¨
   - å¦‚æœå­˜åœ¨ï¼Œå»ºç«‹å…³è”å…³ç³»
   - å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æŒä»“è®°å½•å¹¶å…³è”
5. **æ•°æ®å¯¼å…¥**: å°†å¤„ç†åçš„æ•°æ®å¯¼å…¥åˆ°Notionæ•°æ®åº“

## APIç«¯ç‚¹

### Webç•Œé¢
- `GET /` - ä¸»é¡µï¼Œæä¾›æ–‡ä»¶ä¸Šä¼ ç•Œé¢
- `POST /upload` - ä¸Šä¼ å¹¶å¤„ç†CSVæ–‡ä»¶
- `GET /config` - è·å–å½“å‰é…ç½®ä¿¡æ¯

### é…ç½®å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| limit | number | 5 | å¯¼å…¥è¡Œæ•°é™åˆ¶ï¼ˆ0è¡¨ç¤ºå…¨éƒ¨ï¼‰ |
| batch_size | number | 10 | æ‰¹é‡å¤„ç†å¤§å° |
| delay | number | 1 | è¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰ |

## é«˜çº§ç”¨æ³•

### ç›´æ¥ä½¿ç”¨Docker

```bash
# æ„å»ºé•œåƒ
docker build -t notion-csv-importer .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 -v $(pwd)/.env:/app/.env:ro notion-csv-importer
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f --tail=100
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥æ‹’ç»é”™è¯¯**
   - æ£€æŸ¥ç«¯å£8000æ˜¯å¦è¢«å ç”¨
   - ç¡®è®¤Dockerå®¹å™¨æ­£åœ¨è¿è¡Œ

2. **ç¯å¢ƒå˜é‡é”™è¯¯**
   - ç¡®ä¿`.env`æ–‡ä»¶å­˜åœ¨ä¸”åŒ…å«æ­£ç¡®çš„å€¼
   - æ£€æŸ¥Dockerå·æ˜ å°„æ˜¯å¦æ­£ç¡®

3. **Notion APIé”™è¯¯**
   - éªŒè¯Notion tokenæ˜¯å¦æœ‰æ•ˆ
   - ç¡®è®¤æ•°æ®åº“IDæ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥é›†æˆæ˜¯å¦æœ‰æ•°æ®åº“è®¿é—®æƒé™

4. **CSVæ–‡ä»¶é”™è¯¯**
   - ç¡®ä¿æ–‡ä»¶ç¼–ç æ­£ç¡®ï¼ˆé»˜è®¤GBKï¼‰
   - æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹åº”ç”¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### è°ƒè¯•æ¨¡å¼

è·å–è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼š

```bash
# è®¾ç½®è°ƒè¯•ç¯å¢ƒå˜é‡
echo "DEBUG=true" >> .env

# é‡å¯å®¹å™¨
docker-compose restart
```

## å¼€å‘è¯´æ˜

### æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

### é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ app.py                 # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ Dockerfile             # Dockeré…ç½®
â”œâ”€â”€ docker-compose.yml      # Docker Composeé…ç½®
â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â”œâ”€â”€ .env                  # ç¯å¢ƒå˜é‡
â”œâ”€â”€ templates/             # HTMLæ¨¡æ¿
â””â”€â”€ static/               # é™æ€æ–‡ä»¶
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚